<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>SysVinit vs. SystemD</title>

    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/theme/init.css">

    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="lib/css/zenburn.css">

    <!-- Printing and PDF exports -->
    <script>
      var link = document.createElement('link');
      link.rel = 'stylesheet';
      link.type = 'text/css';
      link.href = window.location.search.match(/print-pdf/gi) ? 'css/print/pdf.css' : 'css/print/paper.css';
      document.getElementsByTagName('head')[0].appendChild(link);
    </script>
</head>
<body>
<div class="reveal">
    <div class="slides">
        <section data-background="img/space_background.jpg" class="intro" data-transition="zoom">
            <h1>SysVinit vs. SystemD</h1>
            <h2>La petite histoire des systèmes d'initialisation</h2>
            <h4>Par</h4>
            <h5 style="font-size: 0.8em;">Paul Delafosse, Thibaut Strecker et Lucas Declercq</h5>
        </section>
        <section data-background-color="#a64d79">
            <section class="concave">
                <h1>Qu'est ce qu'un système d'initialisation ?</h1>
                <img src="img/obama.gif">
            </section>
            <section>
                <h3>Le système d'initialisation : </h3>
                <ul>
                    <li class="fragment">
                        C'est le premier processus démarré après le démarrage du kernel.
                    </li>

                    <li class="fragment">Dans les
                        faits, ce processus prend le PID 1 sur le système.
                    </li>

                    <li class="fragment">Il est toujours lancé par le kernel de Linux,
                        après les premières étapes de boot réalisées par le BIOS et le bootloader.
                    </li>
                    <li>
                    Pour avoir un résumé de tout ce que fait le pid 1 au moment du boot : 
                    <pre><code>$ systemd-analyse plot > boostpid.svg </code></pre>
                    </li>
                </ul>
            </section>
            <section class="concave">
                <p>
                    Ce processus
                    doit toujours être actif.
                    Si jamais PID 1 est interrompu on entre alors en Kernel Panic !
                </p>
            </section>
            <section>
                <video data-autoplay="" loop="loop" src="img/bomb.mp4">
                </video>
            </section>
            <section>
                <h3>Pourquoi ce processus est-il si vital ?</h3>
                <ul>
                    <li class="fragment">Un processus est toujours créé par un autre, appelé son processus père.</li>
                    <li class="fragment">Exception faite du processus initial qui est <u>le père de tous les autres !</u></li>
                </ul>
            </section>
            <section>
                I AM YOUR FATHER GIF
            </section>
            <section>
                <h3>Les roles d'un système d'initialisation :</h3>
                <ul>
                <li class="fragment">Il démarre le reste des processus nécessaire au lancement du système
                    d'exploitation</li>
                <li class="fragment">Il gère le cycle de vie des autres processus</li>
                <li class="fragment">Il gère le nettoyage des processus orphelins (processus zombies)</li>
                <li class="fragment">Il a aussi un rôle de monitoring</li>
                </ul>
            </section>
        </section>
        <section data-background-color="#783f04">
            <section>
                <h1>SysVinit</h1></section>
            <section>
                <h3>Un peu d'histoire ...</h3>
                <ul>
                <li class="fragment">Init fait référence à SysV int, le système d’initialisation de SystemV le premier
                    système d’exploitation Unix commercial.</li>
                <li class="fragment">SysV a connu 4 versions majeures depuis la première en 1983, dont la quatrième
                    (SRV4) a été le principal succès commercial, soutenu par les principaux vendeurs de systèmes
                    Unix.</li>
                </ul>
            </section>
            <section>
                <p>Init est donc un très vieux système !</p>
                OLD GIF
            </section>
            <section>
                <h3>On peut découper Init en deux composants principaux :</h3>
                <ul>
                    <li class="fragment">Les runlevels</li>
                    <li class="fragment">Les scripts d'initialisation</li>
                </ul>
            </section>
            <section>
                <h3>Les Runlevels</h3>
                <ul>
                <li class="fragment">Un runlevel est un des modes dans lequel un système Unix s'exécute. Chaque runlevel
                    possède un
                    certain nombre de processus actifs ou stoppés.</li>
                <li class="fragment">Après que le kernel a démarré, init lit le fichier /etc/inittab pour déterminer le
                    comportement de
                    chaque runlevel ainsi que le runlevel par défaut.</li>
                <li class="fragment">
                    À moins que l'utilisateur ait spécifié un paramètre spécial au démarrage, le système va essayer de
                    démarrer au runlevel par défaut (ex : 3 pour les systèmes Red Hat)
                </li>
                </ul>
            </section>
            <section>
                <h3>
                    Il existe 8 runlevels : 0 à 7 :
                </h3>
                <table class="reveal">
                    <thead></thead>
                    <tr>
                        <th>Runlevel</th>
                        <th>Mode</th>
                        <th>Actions</th>
                    </tr>
                    <tbody>
                    <tr>
                        <td>0</td>
                        <td>Halt</td>
                        <td>Éteint le système</td>
                    </tr>
                    <tr>
                        <td>1</td>
                        <td>Single-User Mode</td>
                        <td>Pas de réseau, de daemons ou d'autre utilisateur que root</td>
                    </tr>
                    <tr>
                        <td>2</td>
                        <td>Multi-User Mode</td>
                        <td>Ne configure pas le réseau ou les daemons</td>
                    <tr>
                        <td>3</td>
                        <td>Multi-User Mode with Networking</td>
                        <td>Démarre le système normalement</td>
                    </tr>
                    <tr>
                        <td>4</td>
                        <td>Undefined</td>
                        <td>Pas utilisé</td>
                    </tr>
                    <tr>
                        <td>5</td>
                        <td>X11</td>
                        <td>Comme le runlevel 3 + interface graphique</td>
                    </tr>
                    <tr>
                        <td>6</td>
                        <td>Reboot</td>
                        <td>Redémarre le système</td>
                    </tr>
                    </tbody>
                </table>
            </section>
            <section>
                <h3>Comment démarrent nos applications ?</h3>
                <p class="fragment">Les applications qui sont démarrés par init ont leur scripts placés dans le dossier
                    /etc/rc.d. Dans
                    ce dossier il y a un dossier pour chaque runlevel : rc0.d, rc1.d etc..
                    Comment lancer des applications au démarrage avec init ?</p>
                <p class="fragment">Si le système démarre par défaut au niveau 3, il faut donc que le script de notre
                    application soit
                    présent dans le dossier rc3.d.</p>
                <small class="fragment">(On peut aussi utiliser un lien symbolique)</small>
            </section>
            <section>
                <h3>Gérer tous ces dossiers, fichiers et liens symboliques parait compliqué...</h3>
                GIF CABLE MESS
            </section>
            <section>
                <h3>Rassurez vous, on peu simplifier !</h3>
                GIF BABY IDEA
            </section>
            <section>
                <p>Grâce à <b>chkconfig</b> on peut visualiser l'activation ou non des scripts pour chaque
                    <b>runlevel</b> :</p>
                <pre><code data-trim data-noescape>root@host:~ # chkconfig --list
filelimits 0:off 1:off 2:on 3:on 4:on 5:on 6:off
syslog 0:off 1:off 2:on 3:on 4:on 5:on 6:off
gpm 0:off 1:off 2:on 3:on 4:on 5:on 6:off
cpanel 0:off 1:off 2:off 3:on 4:on 5:on 6:off
kudzu 0:off 1:off 2:off 3:on 4:on 5:on 6:off
ntpd 0:off 1:off 2:off 3:off 4:off 5:off 6:off
netfs 0:off 1:off 2:off 3:on 4:on 5:on 6:off
network 0:off 1:off 2:on 3:on 4:on 5:on 6:off
netplugd 0:off 1:off 2:off 3:off 4:off 5:off 6:off
rawdevices 0:off 1:off 2:off 3:on 4:on 5:on 6:off
ipchains 0:off 1:off 2:on 3:on 4:on 5:on 6:off
iptables 0:off 1:off 2:on 3:on 4:on 5:on 6:off
crond 0:off 1:off 2:on 3:on 4:on 5:on 6:off
anacron 0:off 1:off 2:on 3:on 4:on 5:on 6:off
cups 0:off 1:off 2:on 3:on 4:on 5:on 6:off
xfs 0:off 1:off 2:on 3:on 4:on 5:on 6:off
xinetd 0:off 1:off 2:off 3:on 4:on 5:on 6:off
httpd 0:off 1:off 2:off 3:on 4:off 5:on 6:off
	            </code></pre>
            </section>
        </section>
        <section data-background-color="#3d85c6">

            <section>
                <h1>SystemD</h1>
                <img src="img/systemd_gandalf.jpg">
            </section>
            <section>
                <p>
                    "systemd est un système d’initialisation et un daemon qui a été spécifiquement
                    conçu pour le noyau Linux comme alternative à System V. Il a pour but d'offrir un
                    meilleur cadre pour la gestion des dépendances entre services, de permettre le chargement
                    en parallèle des services au démarrage, et de réduire les appels aux scripts shell."
                </p>
            </section>
            <section>
                <p>
                    SystemD a été créé en 2010 par Lennart Poettering et Kay Sievers,
                    et a été à l’origine d’intenses débats au sein de la communauté UNIX.
                </p>
                <img scr=""/>
                <quote>
                    "I don't actually have any particularly strong opinions on systemd itself.
                    I've had issues with some of the core developers that I think are much too
                    cavalier about bugs and compatibility, and I think some of the design details
                    are insane (I dislike the binary logs, for example),
                    but those are details, not big issues."
                    L. Torvalds
                </quote>
            </section>
            <section>
                <h3>Les différences avec Init :</h3>
                <ul>
                    <li class="fragment">KISS</li>
                    <li class="fragment">orienté configuration</li>
                    <li class="fragment">parallélisation</li>
                    <li class="fragment">cgroups</li>
                    <li class="fragment">"The Journal"</li>
                    <li class="fragment">Timer</li>
                    <li class="fragment">la galaxie systemD</li>
                </ul>
            </section>
            <section>
                <h3>KISS</h3>
                <i>"Keep it simple stupid"</i>
                <img id="torvald" src="images/retarded.gif">
            </section>
            <section>
                <h3>Configuration</h3>
                <p>
                    On reprend l'exemple
                    de Gitlab avec systemd.
                    La syntaxe des fichiers de
                    configuration systemd
                    est inspirée des standards du X Desktop
                    Group qui eux même s'inspirent
                    des fichiers Microsoft .ini
                </p>
                <pre style="width: 50%; margin-left : 0%;"><code>
#####################################################
#
# GitLab version    : 5.x - 7.x
# Contributors      : davispuh, mtorromeo, axilleas, boeserwolf91, Stefan Tatschner (rumpelsepp)
# Downloaded from   : https://gitlab.com/gitlab-org/gitlab-recipes/tree/master/init/systemd
#
####################################################

[Unit]
Description=GitLab Unicorn Server
Requires=redis.service
Wants=mysqld.service postgresql.service
After=redis.service mysqld.service postgresql.service

[Service]
User=git
WorkingDirectory=/home/git/gitlab
Environment=RAILS_ENV=production
SyslogIdentifier=gitlab-unicorn
PIDFile=/home/git/gitlab/tmp/pids/unicorn.pid

ExecStart=/usr/bin/bundle exec "unicorn_rails -D -c /home/git/gitlab/config/unicorn.rb -E production"

[Install]
WantedBy=multi-user.target</code></pre>
            </section>
            <section>
                <h3>Parallélisation</h3>
                <p>
                    Un des gros avantage de systemD sur init c'est
                    sa capacité à lancer des processus en parallèle
                    via utilisation de sockets et D-bus.
                </p>
                <p>
                    Socket et D-bus sont deux ensembles normalisées
                    de fonctions qui permettent au processus de
                    parager des données et d'échanger des messages
                </p>
            </section>
            <section>
                <h3>Contrôle tes logs!</h3>
                <p>
                    Dans systemd logs sont associé à un groupe afin de réduire les chances 
                    de corruptions lors d'un piratage, ils sont portables,
                    et l'outil comporte une gestion de saturation de l'espace. 
                </p>
                <p>
                    Tout service géré par systemd est automatiquement logué, 
                    sauf si celui-ci demande à ne pas l'être.
                    On accède au logs via la commande journalctl.
                </p> 
            </section>
            <section>
                <h3>Les Timers</h3>
                <p>Un timer est un fichier permettant de controller les services,
                ainsi que les events</p>
                <p>Les timers peuvent être utilisés en remplacement de cron.</p>
                <video playsinline src="https://media.giphy.com/media/Emg9qPKR5hquI/giphy.mp4" loop="loop"></video>
            </section>
            <section>
                <p>
                </p>
            </section>
            <section>
                <p>C'est un fichier spécifique à systemd, qui est obligatoirement associé à un service existant.<br>
                    Par défaut, un timer est associé au service ayant le même nom que lui.</p>
                <p>Ex : foo.timer est associé a foo.service.</p>
            </section>
        </section>
        <section data-background-color="#6aa84f"><h1>Travaux Pratiques</h1></section>
        <section data-background-color="#8e7cc3"><h1>Questions ?</h1></section>
    </div>
</div>

<script src="lib/js/head.min.js"></script>
<script src="js/reveal.js"></script>

<script>
  // More info about config & dependencies:
  // - https://github.com/hakimel/reveal.js#configuration
  // - https://github.com/hakimel/reveal.js#dependencies
  Reveal.initialize({
    dependencies: [
      {src: 'plugin/markdown/marked.js'},
      {src: 'plugin/markdown/markdown.js'},
      {src: 'plugin/notes/notes.js', async: true},
      {
        src: 'plugin/highlight/highlight.js', async: true, callback: function () {
          hljs.initHighlightingOnLoad();
        }
      }
    ]
  });

  Reveal.configure({
    slideNumber: 'c/t'
  });
</script>
</body>
</html>
